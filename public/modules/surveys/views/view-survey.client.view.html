<section class="surveyDisplay"  data-ng-controller="SurveysController" data-ng-init="findOne()">
    <div data-ng-controller="PagesController">
        <div class="surveySection">
            {{page.title}}
        </div>
        <p class="pageHeader"  ng-bind-html= "page.header"></p>
        <br>

        <ng-form name="pageForm">
            <div data-ng-repeat="question in questions| orderBy: 'number'" data-ng-href="#!/questions/{{question._id}}">
                <ng-form class="choices" name="questionForm">
                    <div class="question-header">
                        <h4><a ng-show="authentication.user.roles[0] === 'admin'" href="/#!/questions/{{question._id}}">{{question.text}}</a></h4>
                        <h4><span ng-hide="authentication.user.roles[0] === 'admin'">{{question.text}}</span></h4>
                    </div>

                    <!-- RADIO -->
                    <div ng-show="question.type==='radio'" class= "choice" data-ng-repeat="choice in question.choices| orderBy: 'order'" data-ng-href="#!/choices/{{choice._id}}">
                        <div>
                            <label>
                                <input type="radio"  name = "{{question._id}}" value = "{{choice._id}}" ng-model= "formData[question._id]" required>
                                {{choice.text}}
                            </label>
                        </div>
                    </div>

                    <!-- CHECKBOX -->
                    <div ng-show="question.type==='checkbox'" class= "choice" data-ng-repeat="choice in question.choices| orderBy: 'order'" data-ng-href="#!/choices/{{choice._id}}">
                        <div>
                            <label>
                                <input type="checkbox"  name="{{question._id}}" ng-value = "[{{question._id}},{{choice._id}}]" ng-model= "formData[question._id][choice._id]">
                                {{choice.text}}
                            </label>
                        </div>
                    </div>


                    <!-- FORM TEXT-->
                    <div ng-show="question.type==='text'" class= "choice" data-ng-repeat="choice in question.choices| orderBy: 'order'" data-ng-href="#!/choices/{{choice._id}}">
                        <div>
                            {{choice.text}}: <input type="text"  name ="{{question._id}}"  ng-model= "formData[question._id]" ng-minlength=3>
                        </div>
                    </div>
                </ng-form>
            </div> Invalid:{{pageForm.$invalid }}<br>
            Unchecked: {{unchecked}}<br>
            SomeChecked:{{someSelected(formData[question._id])}}
        </ng-form>


            <button  ng-hide="page.nextButtonText ==='Start survey'" data-ng-click="submitForm()" ng-disabled="pageForm.$invalid && (unchecked || !someSelected(formData[question._id]))" class="btn btn-primary" >{{page.nextButtonText}}</button>
        </form>
        <div class="buttons">
            <div class="oneButton">
                <div ng-show="page.nextButtonText ==='Start survey'">
                    <a class="btn btn-primary" ng-click="startSurvey()">{{page.nextButtonText}}</a>
                </div>
            </div>
            <div ng-show="authentication.user.roles[0] === 'admin'">
                <a class="btn btn-primary leftButton" ng-click="previousPage()">{{page.previousButtonText}}</a>
                <a class="btn btn-primary" href="/#!/surveys/{{survey._id}}/edit">Modify survey</a>
            </div>
        </div>
        <div id="footer">
            Confidential. For research purposes only.
        </div>
    </div>
</section>
